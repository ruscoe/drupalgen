<?php

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function drupalgen_form_node_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  // Add a wrapper div so we can target it with AJAX.
  $form['drupalgen_ajax_wrapper'] = [
    '#type' => 'container',
    '#attributes' => ['id' => 'drupalgen-ajax-wrapper'],
  ];

  $form['drupalgen_ajax_wrapper']['prompt'] = [
    '#type' => 'textfield',
    '#title' => t('ChatGPT Prompt'),
    '#description' => t('Enter a prompt like: "Outline an article on liquid cooling in PCs."'),
    '#default_value' => '222',
  ];

  $form['drupalgen_ajax_wrapper']['generate_button'] = [
    '#type' => 'button',
    '#value' => t('Generate'),
    '#ajax' => [
      'callback' => 'drupalgen_ajax_callback',
      'wrapper' => 'drupalgen-ajax-wrapper',
      'effect' => 'fade',
    ],
    // Prevent triggering the full form submit.
    '#limit_validation_errors' => [],
  ];
}

/**
 * AJAX callback.
 */
function drupalgen_ajax_callback(array &$form, FormStateInterface $form_state) {
  $value = $form_state->getValue('prompt');

  \Drupal::messenger()->addMessage('AJAX says: ' . $value);

  return $form['drupalgen_ajax_wrapper'];
}
